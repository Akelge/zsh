profile=$1

if [ $profile ]; then
  match=$(grep $profile ~/.aws/config | sed -E 's/\[profile (.+)\]/\1/')
  if [ $match ]; then
    echo "Activating $match"
    export AWS_DEFAULT_PROFILE=$match
    export AWS_PROFILE=$match
    export AWS_EB_PROFILE=$match
    return
  else
    echo "No match for $profile"
    return
  fi
elif [ $AWS_PROFILE ]; then
  unset AWS_DEFAULT_PROFILE AWS_PROFILE AWS_EB_PROFILE
  echo AWS profile cleared.
  return
fi

echo "Available profiles"
grep profile ~/.aws/config | sed -E 's/\[profile (.+)\]/\1/'
